-- This file defines a global keymap in Normal mode ('n') to toggle LSP Inlay Hints
-- using the 'T' key.

vim.keymap.set('n', 'T', function()
  -- Get the current buffer number to ensure the check and toggle are buffer-specific
  local bufnr = vim.api.nvim_get_current_buf()

  -- Check if any attached LSP client supports the 'textDocument/inlayHint' method
  local supported = false
  for _, client in pairs(vim.lsp.get_active_clients { bufnr = bufnr }) do
    if client.supports_method 'textDocument/inlayHint' then
      supported = true
      break
    end
  end

  if supported then
    -- Toggle the inlay hints state for the current buffer
    local is_enabled = vim.lsp.inlay_hint.is_enabled { bufnr = bufnr }
    vim.lsp.inlay_hint.enable(not is_enabled, { bufnr = bufnr })

    -- Optional: Display a message in the command line for confirmation
    local state = not is_enabled and 'ENABLED' or 'DISABLED'
    print('LSP Inlay Hints ' .. state .. ' for buffer ' .. bufnr)
  else
    -- Notify the user if the feature isn't available. This is the most likely failure point.
    print(
      'Inlay Hints: No active LSP client found for buffer ' .. bufnr .. ', or attached client does not support the feature (e.g., clangd needs to be active).'
    )
  end
end, {
  noremap = true,
  silent = true,
  desc = 'Toggle LSP Inlay Hints (T)', -- This description appears when you use <leader>h
})
