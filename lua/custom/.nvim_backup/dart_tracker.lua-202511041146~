-- COSC 60 25F Final Project
-- Ben Cavanagh, Josh Meise
--
-- Keystroke tracker for dart collaborative
-- editor. Converts all nvim keystrokes into
-- "insert" "delete" or "replace" edits.
--

UPDATES = {}

function UPDATES.log_updates(buffer)
  local send = false -- Should we return the entire starting buffer?
  vim.api.nvim_buf_attach(buffer, send, {
    on_bytes = function(str, _, tick, srow, scol, _, oerow, oecol, _, nerow, necol, _)
      vim.notify("reached here")
      table.insert(UPDATES, {str, tick, srow, scol, oerow, oecol, nerow, necol})
      local log_file = io.open("~/dartmouth/classes/cosc60-final/dartlog.txt", "a")
      print("logfile number: ", log_file)
      if log_file ~= nil then
        log_file:write(UPDATES[-1], '\n')
      end
      vim.notify("reached there")
    end
  })
end

function UPDATES.start()
  vim.notify("Starting change tracker")
  UPDATES.log_updates(vim.api.nvim_get_current_buf())
end

return UPDATES
